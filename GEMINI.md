# Gemini Project Log - k6-scenario-builder

이 문서는 AI 에이전트(Gemini)가 `k6-scenario-builder` 프로젝트에서 수행한 주요 작업 및 변경 사항을 기록합니다. 향후 컨텍스트를 유지하고 작업을 계속하는 데 사용됩니다.

## 개발 규칙
1. 클린 코드를 지향하고, 객체지향 5대 원칙(SOLID) 준수
2. 도메인 중심 설계가 어울리는 경우 도메인 모델 패턴 사용, 데이터 중심이라면 트랜잭션 스크립트 패턴 사용
3. 레이어 간 철저한 DTO 분리로 응집도는 높이고 결합도는 낮춤
4. 무조건 코드 수정하지 말고, 수정 방향을 확인받고 진행
5. **진행 사항은 GEMINI.md 파일에 다음 세션과의 연속성을 위해 자세하게 정리**

## 프로젝트 목표

기존의 "load-test-toy" 프로젝트를 발전시켜, 어떤 Spring Boot 애플리케이션이든 쉽게 부하 테스트 시나리오를 생성하고 실행할 수 있는 라이브러리 및 도구를 구축하는 것입니다.

---

## 로드맵 (Phase 1 시작)

### **Phase 1: 핵심 엔진 구축 - API 분석 및 k6 함수 라이브러리 생성**

이 단계의 목표는 Spring Boot 컨트롤러 코드를 자동으로 분석하여, 각 API 엔드포인트에 해당하는 k6 함수들이 들어있는 JavaScript 라이브러리 파일을 생성하는 것입니다.

1.  **프로젝트 구조 변경 (멀티 모듈):**
    *   `load-test-core`: 코드 분석, 스크립트 생성 등 핵심 로직을 담을 라이브러리 모듈.
    *   `load-test-gradle-plugin`: 커스텀 Gradle Task를 제공할 플러그인 모듈.
    *   `sample-app`: 개발된 라이브러리와 플러그인을 테스트할 샘플 Spring Boot 애플리케이션 모듈.

2.  **API 엔드포인트 분석기 개발:**
    *   **Annotation Processor** 기술을 사용하여, 컴파일 시점에 `@RestController`, `@GetMapping` 등의 어노테이션을 분석합니다.
    *   분석된 API 정보(URL, HTTP Method, 파라미터 등)를 중간 결과물인 메타데이터 파일(예: `build/api-meta.json`)로 생성합니다.

3.  **k6 함수 생성기 개발:**
    *   API 메타데이터 파일을 읽어, 각 컨트롤러별로 k6 함수 라이브러리 파일(예: `user-controller.js`)을 동적으로 생성합니다. 각 파일은 API 호출 함수들을 `export` 합니다.

4.  **Gradle 플러그인 구현:**
    *   `generateK6Scripts`라는 Task를 만들어, 위 2, 3번 과정을 한 번에 실행할 수 있도록 합니다.

---

### **Phase 2: 시나리오 빌더 UI 개발**

이 단계의 목표는 1단계에서 생성된 함수들을 사용자가 시각적으로 조립하여 테스트 시나리오를 만들 수 있는 웹 인터페이스를 구축하는 것입니다.

1.  **UI 프로젝트 생성:**
    *   React, Vue 등 최신 프레임워크를 사용하여 시나리오 빌더 UI 프로젝트를 시작합니다.

2.  **함수 팔레트(Palette) 구현:**
    *   1단계에서 생성된 API 메타데이터 파일을 읽어, 사용 가능한 모든 API 함수 목록을 UI에 표시합니다.

3.  **시나리오 조립 캔버스 구현:**
    *   사용자가 함수 목록에서 원하는 함수를 드래그 앤 드롭하거나 클릭하여 테스트 순서를 구성할 수 있는 작업 공간을 만듭니다. (예: `createUser` 실행 -> 1초 대기 -> `getUserById` 실행)

4.  **파라미터 입력 UI 구현:**
    *   시나리오에 추가된 각 함수 블록에 대해, 필요한 파라미터(Request Body, Path Variable 등)를 입력할 수 있는 UI를 제공합니다.

5.  **시나리오 저장/로드:**
    *   사용자가 만든 시나리오를 JSON 형태로 저장하고 불러올 수 있는 기능을 구현합니다.

---

### **Phase 3: 테스트 실행 엔진 연동**

이 단계의 목표는 시나리오 빌더에서 만든 시나리오를 실제로 실행하고 결과를 확인하는 것입니다.

1.  **최종 스크립트 생성기 개발:**
    *   UI로부터 시나리오 JSON을 전달받아, k6 함수 라이브러리를 `import`하고 시나리오 순서대로 함수를 호출하는 **최종 실행용 k6 스크립트**를 동적으로 생성하는 백엔드 서비스를 개발합니다.

2.  **k6 실행 서비스 연동:**
    *   기존에 만들어 둔 `K6ControlService`를 활용하여, 1단계에서 생성된 최종 스크립트를 VUser, RPS 등과 함께 실행하도록 연동합니다.

3.  **결과 표시 UI 연동:**
    *   k6 테스트 실행 결과를 다시 UI로 가져와 사용자에게 보여줍니다.

---

### **Phase 4: 고급 기능 및 고도화**

1.  **데이터 연관관계(Correlation) 처리:**
    *   한 API의 응답(예: `createUser`의 `userId`)을 추출하여 다음 API의 요청 파라미터로 사용할 수 있는 기능을 시나리오 빌더에 추가합니다.
2.  **응답 검증(Assertions) 기능:**
    *   k6의 `check()` 함수처럼, API 응답의 상태 코드나 내용이 올바른지 검증하는 로직을 UI에서 추가할 수 있도록 합니다.
3.  **환경 관리 기능:**
    *   테스트 대상 서버(local, dev, staging)를 쉽게 변경할 수 있는 UI를 추가합니다.
4.  **라이브러리 패키징 및 배포:**
    *   개발된 Gradle 플러그인과 라이브러리를 실제 다른 프로젝트에서 `implementation(...)`으로 추가하여 사용할 수 있도록 패키징하고 배포합니다.

---

## **현재 진행 상황 (Phase 1 - 프로젝트 구조 변경 완료)**

### **2025년 11월 18일**

-   **새 프로젝트 생성**: `~/projects/k6-scenario-builder` 디렉토리 생성.
-   **Gradle 멀티 모듈 설정**:
    -   `settings.gradle` 파일 생성 (`rootProject.name = 'k6-scenario-builder'`, `include 'load-test-core'`, `include 'load-test-gradle-plugin'`, `include 'sample-app'`).
    -   루트 `build.gradle` 파일 생성 (Java 17, 공통 그룹/버전/저장소 설정).
    -   각 서브 프로젝트 (`load-test-core`, `load-test-gradle-plugin`, `sample-app`)의 디렉토리 구조 및 빈 `build.gradle` 파일 생성.
-   **Java 버전 설정**: 회사 프로젝트와의 호환성을 위해 모든 서브 프로젝트의 Java 버전을 17로 설정.
